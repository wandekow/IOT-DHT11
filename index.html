<!DOCTYPE html>
<html>
<head>
  <title>Dashboard IoT</title>
  <script src="https://cdn.jsdelivr.net/npm/mqtt/dist/mqtt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Monitoramento DHT11</h2>
  <canvas id="grafico" width="400" height="200"></canvas>

  <script>
    const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

    const labels = [];
    const tempData = [];
    const humData = [];

    const ctx = document.getElementById("grafico").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [
          {
            label: "Temperatura (Â°C)",
            data: tempData,
            borderColor: "red",
            fill: false
          },
          {
            label: "Umidade (%)",
            data: humData,
            borderColor: "blue",
            fill: false
          }
        ]
      }
    });

    client.on("connect", () => {
      console.log("Conectado ao MQTT");
      client.subscribe("senai/iot/dht11");
    });

    client.on("message", (topic, message) => {
      const data = JSON.parse(message.toString());
      const time = new Date().toLocaleTimeString();

      labels.push(time);
      tempData.push(data.temperatura);
      humData.push(data.umidade);

      if (labels.length > 20) {
        labels.shift();
        tempData.shift();
        humData.shift();
      }

      chart.update();
    });
  </script>
</body>
</html>